---
title: "L2 Proficiency as a Function of Age and Aptitiude (pa5)"
author: "Chris Oakden"
date: "4/3/2018"
output: 
  html_document: 
    highlight: textmate
    theme: yeti
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Introduction
The purpose of this midterm is to address the question: is L2 learning affected by learner age and general language learning aptitude? The current study presents the results of a language proficiency exam experiment aimed at exploring this question. Participants were split up into two age groups (older vs younger), and their iq and language learning motivation values were obtained. Results of statistical modeling indicate that both age and general language learning aptitude affect L2 language learning, with the latter effect being further modulated by age.

##Load the Dataset

Here we load the dataset and look at the first six rows.
```{r load, message=FALSE, warning=FALSE}
#load the tidyverse and the data
library(tidyverse)
library(ggfortify)
data <- read_csv("./data_raw/lang_data_raw.csv")
#print the first six rows
head(data, 6)
```


##Tidy the Data
In order to make the data tidy, we must use `tidyr::separate` to break up the "id" column into three separate columns for participant ID, sex, and age. This will allow us to use "age" as a factor in our models.
```{r tidy}
lang_tidy <- data %>%
  separate(., id, into = c("subject", "sex", "age"), sep = "_")
```

##Create the Composite Variable
Now that the data is tidy, the next step is to create a new composite language learning ability metric variable, using the iq and motivation values from the current dataframe. Previous research has used these to values to generate a score to quantify a learner's general language learning aptitude, so we will need this for our models. The score is calculated by log-transforming the iq (minus 80), and adding the log-transformed motivation values, as shown below. It is also possible to standardize these values by calculating the z-score.

```{r composite}
#create new variable and standardized version using mutate()
tidy_2 <- lang_tidy %>%
  mutate(., composite_score = log(iq / 80) + log(motivation)) %>%
  mutate(., cas_stan = (composite_score - mean(composite_score))/ sd(composite_score))
```

##Descriptive Statistics
Let us look briefly at some of the mean and standard deviation values of interest. What we would like to see is if, in general, younger L2 learners perform better on the proficiency test than older L2 learners, therefore we will group the data by age. The previous research does not suggest that biological sex plays a role in L2 learning, so we will not focus on that variable, in spite of it being specified in our data.

```{r desc}
#use summarize() to summarize the means/sd of proficiency score as a function of age
tidy_2 %>%
  group_by(., age) %>%
  summarize(., Score_Mean = mean(prof), Score_sd = sd(prof)) %>% knitr::kable(., format = 'html', digits = 2)
```

The table above indicates that the younger learners' mean proficiency score is higher than that of the older learners sampled in the study. Their standard deviations are roughly the same.

##Plot
One plot of the data is provided. This plot explores the possible relationship between the composite aptitude score and the score on the proficiency exam. The plot below (and the fitted regression line) suggests a positive correlation between the two variables, such that as the learners' iq and motivation increase, so does their performances on the proficiency test.
```{r plot}
#create a scatterplot using geom_point and a regression line using geom_smooth
#with the "lm" method specified
tidy_2 %>%
  ggplot(., aes(cas_stan, prof, color = age)) +
  geom_point() +
  geom_smooth(method = lm) +
  labs(x = "Composite Aptitude Score", y = "Proficiency Exam Score",
       title = "Proficiency Exam Score as a Function of Composite Aptitude, 
       Older and Younger Learners")
```

The plotted values are also separated by the participants' age, corroborating the generalization from the mean values, that is, that younger learners perform better on the proficiency exam than older learners. To test for main effects and interactions, it is necessary to fit models to these data.

##Model Fitting
The main research question here is to determine whether proficiency score varies as a function of age and composite score (and possibly via an interaction between the two). Below is a description of model fitting used to explore these questions.

The data were analyzed using a general linear model. Proficiency test score was the criterion with the categorical variable *learner age* (older/younger) and the continuous variable *composite score* (standardized via z-score transformation) as predictors. The age factor was dummy coded with older learners set as the reference group. See the models below.

```{r models}
#fit models using lm()
mod_full <- lm(prof ~ age + cas_stan + age:cas_stan, data = tidy_2)
mod_int  <- lm(prof ~ age + cas_stan,                data = tidy_2)
mod_comp <- lm(prof ~ age,                           data = tidy_2)
mod_age  <- lm(prof ~ cas_stan,                      data = tidy_2)
mod_null <- lm(prof ~ 1,                             data = tidy_2)
```


Main effects and the age-by-composite-score interaction were assessed using nested model comparisons (using the `anova()` function. Experiment-wise alpha was set at 0.05.

```{r comparisons}
#compare models using the anova() function
#interaction term
comparison_1 <- anova(mod_int, mod_full)
#composite_score
comparison_2 <- anova(mod_comp, mod_int)
#age
comparison_3 <- anova(mod_age, mod_int)
```


#Results and Model Assumptions
A summary of the best-fitting model is provided below.
```{r summary}
summary(mod_full)
```

Model comparison revealed main effects of learner age (F(1) = 64.181, p < 0.05) and language learning aptitude via the composite score (F(1) = 81.049; p < 0.05), as well as an age-by-composite-score interaction (F(1) = 9.815; p < 0.05). The model containing the interaction term provided the best fit of the data ($r^2$ = 0.4434 compared to $r^2$ = 0.4185 for the alternative model). Younger learners outperformed older learners in the proficiency exam, but *overall*, exam score did increase as a function of general language learning ability. Additionally, the size of this effect was modulated by the learner's age. Specifically, participants showed an increase in (standardized) score of approximately 0.095 points +/- .011 se per unit increase in general language learning ability (t = 8.722, p < 0.05). However, for the older participants, their average per-unit increase was 0.048 points (.015 se) *less* than the younger speakers.

To determine the reliability of the models, certain model diagnostics were performed, including tests for the normal distribution and homoskedasticity of the residuals (using `ggfortify::autoplot()`). In general, the mean of the residuals is zero (via a test using `mean(mod_full)$residuals`).
```{r diagnostics}
#check the distribution of the residuals
autoplot(mod_full, which = 2)
#check whether the residuals are homoskedastic
autoplot(mod_full, which = 1)
```

Visual inspection of these plots indicates that these model assumptions have not been violated (modulo three influential data points). This model can therefore be considered reliable.

#Conclusion
This study has offered new data in the L2 learning literature, addressing the question of whether age and general language learning ability affect L2 learning. The results of a proficiency exam experiment indicate that age and general language learning ability to affect L2 learning, and further that the effect of general language learning ability is modulated by age.



