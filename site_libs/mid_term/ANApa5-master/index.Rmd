---
title: "Midterm Exam: PA5"
author: "Ana Bennett"
date: "4/3/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load libraries, message=FALSE, echo=FALSE}
library(tidyverse)
library(ggfortify)
```
#Data on Learning a Second Language
```{r load data set, message=FALSE, echo=FALSE}
lang <- read.csv("~/Desktop/students/ANApa5-master/data_raw/pa_5_data/lang_data_raw.csv")
head(lang)
```
#Tidying the data set

Separate ID column into participant, sex, and age, using the separate() function 

The data is now tidy because:
(1)each variable must have its own column (2) each observation must have its own row, (3) each value must have its own cell 
```{r "tidy_data", message=FALSE}
t_lang <- lang %>%
  separate(., id, into = c("participant", "sex", "age"), sep = "_")
head(t_lang)
```
#Create a new variable for composite language learning score

```{r create composite score variable, message=FALSE}
n_lang <- t_lang %>%
  select(., participant, sex, age, iq,motivation, prof)%>%
  mutate(., composite_score = log(iq/80) + log(motivation),
            compc = composite_score - mean(composite_score))
```

# Centering the data
Purpose:to create a more meaningful intercept



# Descriptive Statistics

Since our hypothesis is that younger people learn languages better than older people, I will include the means, standard deviations, for older individual, as well as younger individuals as a function of language aptitude. Additionally, since we are interested in scores vary as a function of age and composite score, I will also include means, standard deviations and min and max for results on proficiency scores. 

For purposes of this assignment (based on previous research), language aptitude is referred to as the variable composite score: which represents the log of our IQ measure and the log of our overall motivation score. 
 
This table demonstrates that younger participants overall had higher composite scores and proficiency scores. 
```{r descriptive stats, message=FALSE}
n_lang %>%
  select(., age, composite_score, prof)%>%
  group_by(., age)%>%
  summarize(., mean = mean(composite_score), sd = sd(composite_score), mean = mean(prof), sd = sd(prof))%>%
  print(knitr::kable(., format = 'html', digits = 2))
  

```



# Scatterplot to demonstrate relationship between age as a function of composite score

This plot indicates a linear relationship between age and composite score
```{r scatterplot, message=FALSE}
n_lang %>%
  select(., age, composite_score, prof)%>%
  ggplot(., aes(x = composite_score, y = prof, color = age))+
  geom_point()+
  geom_smooth(method = 'lm')+
  labs( x = "composite score", y = "proficiency", title = "Age as a function of composite score")

```


#Fitting Models

```{r, message = FALSE}
mod_null <- lm(prof~1, data = n_lang)
summary(mod_null)
```

```{r}
mod_cat <- lm(prof~age, data = n_lang)
summary(mod_cat)
```

```{r}
mod_add <- lm(prof~ age + composite_score, data = n_lang)
summary(mod_add)
```

```{r, mod-interaction, message = FALSE}
mod_int <- lm(prof~age + age:composite_score, data = n_lang)
summary(mod_int)
```

#Nested model comparisons 
```{r}
anova(mod_null, mod_cat, mod_add, mod_int)
```
#Test Model Assumptions: Residuals = 0
The scatterplot reveals that the model is linear
```{r}
summary(mod_int$residuals)
```
#Test Model Assumptions: Autocorrelation of Residuals
```{r}
acf(mod_int$residuals)
lmtest::dwtest(mod_int)
```
#Test Model Assumptions: Homoscedasticity
```{r}
plot(fitted(mod_int), residuals(mod_int))
```

#Test Model Assumptions: Normal Distribution of residuals
```{r}
qqnorm(residuals(mod_int))
qqline(residuals(mod_int))
```

# Description of statistical analyses 
The production data were analyzed using generalized linear model to test the effect of proficiency scores vary as a function of age (younger/older) and composite aptitude score. Scores for both proficiency and composite aptitude were centered. The model also included an age by language aptitude interaction. Visual inspection of the Q-Q plots and plots of residuals against fitted values revealed that the assumptions of normality and homoscedasticity were in tact. Statistical significant of age and age by composite score interactions were accessed using hierarchical portioning of variance via nested model comparisons. Lastly, R2 and adjusted R2 indicated a goodness of fit for each model. This analysis revealed that the interation model was the best model fit (R2 = .443)

#Results
The model revealed a main effect of age F(1) = 67.0531, p < .001 and a main effect of composite score F(1) = 84.6757, p < .001. Additionally, the nested model comparison revealed that there was an interaction between age and composite score, F(1) = 9.8147, p < 0.01. This suggests that composite score varies as age changes. Specifically, that their was a difference between older and younger participants on composite score, and furthermore that this was influenced by their score on language aptitude. Thus, we can conclude that this is evidence in support of our hypothesis that proficiency scores vary as a function of age (younger/older) and composite aptitude score. 

