---
title: "Midterm Exam"
author: "Nate Koser"
date: "April 3, 2018"
output: 
  html_document: 
    theme: cerulean
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```
### Loading the data

Here I load the dataset and print the first few rows. 
```{r loaddata, message = FALSE}

lang_data_raw <- read_csv("data_raw/pa_5_data/lang_data_raw.csv")
head(lang_data_raw)
```

### Tidy the data

Here I tidy the data by giving sex (male, female) and age group (young, older) their own columns because they are variables. 
```{r tidydata, message = FALSE}
datatidy <- lang_data_raw %>%
  separate(., col = "id", into = c("id", "sex", "age"), sep = "_")
head(datatidy)
```

### Add a column

Here I use mutate() to create a "composite score" column. 
```{r addcolumn, message = FALSE}
datatidy <- datatidy %>%
  mutate(., composite_score = log(iq / 80) + log(motivation))
head(datatidy)
```

### Descriptive statistics

Here I present some descriptive statistics for the data, creating new sub-frames by filtering for desired values of the sex variable. 
```{r stats, echo = TRUE, message = FALSE}
datamale <- datatidy %>%
  filter(., sex == "male")
datafemale <- datatidy %>%
  filter(., sex == "female")
```
| Sex     | Mean IQ       | Mean Motivation |
| :-      | :-            | :-              |
| male       | `r round(mean(datamale$iq), 2)`    | `r round(mean(datamale$motivation), 2)` |
| female     | `r round(mean(datafemale$iq), 2)`   | `r round(mean(datafemale$motivation), 2)` |
There does not seem to be much of a difference between male and female average IQ or motivation. I would hazard a guess that the small difference that does occur is not statistically significant, but I wouldn't bet a lot of money on it without fitting some models.


### Plot the data

Here I present a plot of the proficiency scores in the data set as a function of age group.
```{r plot}
ggplot(data = datatidy, aes(x = age, y = prof, fill = age)) +
  geom_boxplot() +
  labs(title = "Proficiency Scores by Age Group", x = "Age Group", y = "Proficiency Scores")
```
We observe a difference between the proficiency scores of the two age groups. The younger age group appears to me more efficient in L2 learning, which is line with our hypothesis. However, eyeballing is not enough - we now turn to more rigorous statistical analysis. 

### The model

Here I fit the model and test various interactions: the two way interaction of age and composite score, the main effect of age, and the main effect of composite score.

```{r modelfitting}
modeldata <- datatidy %>%                #select the variables
  select(., age, prof, composite_score)

mod_full <- lm(prof ~ age + composite_score + age:composite_score, data = modeldata) #the full model

mod_noint <- lm(prof ~ age + composite_score                     , data = modeldata) #no interaction

mod_age <- lm(prof ~ age, data = modeldata) #main effect of age

mod_comp <- lm(prof ~ composite_score, data = modeldata) #main effect of composite score


anova(mod_noint, mod_full) #How much variance is explained by the interaction?

anova(mod_noint, mod_age) #How much variance is explained by age?

anova(mod_noint, mod_comp) #How much variance is explained by composite score?
```
The results of the anova comparisons of different models suggests that the best model is the full one - the one where we keep both age and composite score as a main effect and keep the interaction of age and composite score as well. A summary of this model is given below. 

```{r modelsummary, echo = FALSE}
summary(mod_full)
```
We see that this model explains ~44% of the variance, with an adjusted R-squared of .44. This is the highest R-squared of any model tested, but is possibly low.

###Check model diagnostics

Here I check the model diagnostics and make sure the model assumptions have been met.

Confidence interval
```{r confint, message = FALSE, echo = FALSE}
confint(mod_full)
```
Mean of residuals is zero
```{r resids, message = FALSE, echo = FALSE}
mean(mod_full$residuals)
```

Check heteroskedasticity 

```{r skedast, fig.width=10, fig.height=6, message = FALSE, echo = FALSE}
plot(fitted(mod_full), residuals(mod_full), main = "Residuals vs. Fitted", 
     ylab = "Residuals", xlab = "Fitted") 
```

Check distribution 

```{r qqline, fig.width=10, fig.height=6, message = FALSE, echo = FALSE}
qqnorm(residuals(mod_full))
qqline(residuals(mod_full))
```

Check influential data points with Cook's distance

```{r cooks, fig.width=10, fig.height=6, message = FALSE, echo = FALSE}
plot(cooks.distance(mod_full), main = "Cook's Distance", 
     ylab = "Cook's Distance", xlab = "Observation Number")
```

These diagnostics give us a good sense of the satisfaction of the model assumptions. I discuss the results more fully in the section below. 

### Analysis and Results

  The data were analyzed using repeated steps of ANOVA to determine the effect of age and composite aptitude score (determined with the formula log(iq / 80) + log(motivation)) on L2 learning proficiency. The model included "proficiency" as the dependent variable and "age" and "composite score" as independent variables. Visual inspection of QQ plots, heteroskedasticity analysis, and Cook's Distance charts suggested a reasonably normal distribution, with some possible clustering towards the right seen in the plot of residuals versus fitted values. 
  
  The ANOVA model comparision revealed that the best model was the "full model" - the model with age, composite score, and their interaction all included. There was a main effect of age (F = 81.05, p < .0001) and a main effect of composite aptitude score (F = 64.18, p < .0001), as well a significant interaction between the two (F = 9.81, p < 0.01). The model tells us that the slope estimates for the included variables are significantly different from zero. This model accounted for about 44% of variance (adjusted R-squared of .44). While this was the most variance explained by any model, it is possible that this is low and that other variables from the data such as sex or iq may explain large portions of variance as well. These results indicate that age and aptitude do play a role in L2 learning proficiency, but that other factors might be at play as well. 
